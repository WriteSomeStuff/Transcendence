<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TOURNAMENT</title>
  <link rel="stylesheet" href="public/styles.css">
</head>
<body>
  <div class="container">
    <h1>Welcome to the TOURNAMENT Room!</h1>
    <p>Ready to have some fun? Join a TOURNAMENT room and let the adventure begin!</p>

    <!-- Each form sets 'gameMode' to a different value -->
    <form action="/joinTournament" method="post">
      <button class="joinGameButton" name="gameMode" value="pong_2" type="submit">
        Join Room Pong (2 players)
      </button>
    </form>

    <form action="/joinTournament" method="post">
      <button class="joinGameButton" name="gameMode" value="pong_3" type="submit">
        Join Room Pong (3 players)
      </button>
    </form>

    <form action="/joinTournament" method="post">
      <button class="joinGameButton" name="gameMode" value="pong_4" type="submit">
        Join Room Pong (4 players)
      </button>
    </form>

    <form action="/joinTournament" method="post">
      <button class="joinGameButton" name="gameMode" value="memory" type="submit">
        Join Memory Game (2 players)
      </button>
    </form>

    <form action="/leaveTournament" method="post">
      <button class="joinGameButton">
        leave game
      </button>
    </form>
  </div>

  <!-- Section to show the joined tournament room info -->
  <div id="roomStatusContainer" style="display: none;">
    <h3>Tournament Room</h3>
    <p>Game Mode: <span id="gameMode"></span></p>
    <p>Players: <span id="playerCount"></span>/<span id="maxPlayers"></span></p>
    <p>Host: <span id="hostId"></span></p>
    <p>Status: <span id="roomStatusText"></span></p>
    <button id="leaveButton">Leave Tournament</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
			
		// Send a "ping" to the server every 5 seconds
		setInterval(async () => {
			console.log("sending pingeling")
			try {
			await fetch('/keepAlive', { method: 'POST' });
			} catch (err) {
			console.log('Keep-alive failed:', err);
			}
		}, 5000);
      // Handle tournament form submissions
      const tournamentForms = document.querySelectorAll('form[action="/joinTournament"]');
      
      tournamentForms.forEach(form => {
        form.addEventListener('submit', async function(e) {
          e.preventDefault(); // Prevent default form submission
          
          // Get the gameMode value from the button
          const gameMode = form.querySelector('button[name="gameMode"]').value;
          
          try {
            const response = await fetch('/joinTournament', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: `gameMode=${encodeURIComponent(gameMode)}`
            });
            
            const data = await response.json();
            
            if (data.success) {
              // Hide join buttons and show room status
              hideJoinButtons();
              showTournamentRoom(data.room);
            } else {
              alert('Error: ' + data.error);
            }
          } catch (error) {
            console.error('Error:', error);
            alert('Failed to join tournament');
          }
        });
      });
      
      // Handle leave tournament
      document.getElementById('leaveButton').addEventListener('click', async function() {
        try {
          const response = await fetch('/leaveTournament', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            hideTournamentRoom();
            showJoinButtons();
          }
        } catch (error) {
          console.error('Error leaving tournament:', error);
        }
      });
    });

    function showTournamentRoom(room) {
      document.getElementById('gameMode').textContent = room.gameMode;
      document.getElementById('playerCount').textContent = room.playerCount;
      document.getElementById('maxPlayers').textContent = room.maxPlayers;
      document.getElementById('hostId').textContent = room.host;
      document.getElementById('roomStatusContainer').style.display = 'block';
    }

    function hideTournamentRoom() {
      document.getElementById('roomStatusContainer').style.display = 'none';
    }

    function hideJoinButtons() {
      const container = document.querySelector('.container');
      if (container) container.style.display = 'none';
    }

    function showJoinButtons() {
      const container = document.querySelector('.container');
      if (container) container.style.display = 'block';
    }

  </script>



</body>
</html>