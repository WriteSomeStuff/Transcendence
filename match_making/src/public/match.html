<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Join Game Room</title>
  <link rel="stylesheet" href="public/styles.css">
</head>
<body>
  <div class="container">
    <h1>Welcome to the Game Room!</h1>
    <p>Ready to have some fun? Join a game room and let the adventure begin!</p>

    <!-- Each form sets 'gameMode' to a different value -->
    <form action="/joinRoom" method="post">
      <button class="joinGameButton" name="gameMode" value="pong_2" type="submit">
        Join Room Pong (2 players)
      </button>
    </form>

    <form action="/joinRoom" method="post">
      <button class="joinGameButton" name="gameMode" value="pong_3" type="submit">
        Join Room Pong (3 players)
      </button>
    </form>

    <form action="/joinRoom" method="post">
      <button class="joinGameButton" name="gameMode" value="pong_4" type="submit">
        Join Room Pong (4 players)
      </button>
    </form>

    <form action="/joinRoom" method="post">
      <button class="joinGameButton" name="gameMode" value="memory" type="submit">
        Join Memory Game (2 players)
      </button>
    </form>
      <form action="/leaveRoom" method="post">
      <button class="joinGameButton">
        leave game
      </button>
    </form>
  </div>
    <!-- Section to show the joined tournament room info -->
  <div id="roomStatusContainer" style="display: none;">
    <h3>Tournament Room</h3>
    <p>Game Mode: <span id="gameMode"></span></p>
    <p>Players: <span id="playerCount"></span>/<span id="maxPlayers"></span></p>
    <p>Host: <span id="hostId"></span></p>
    <p>Status: <span id="roomStatusText"></span></p>
    <button id="leaveButton">Leave Tournament</button>
  </div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    // Send a "ping" to the server every 5 seconds
    setInterval(async () => {
      console.log("sending pingeling from match.html"); // Differentiate console logs
      try {
        await fetch('/keepAlive', { method: 'POST' });
      } catch (err) {
        console.log('Keep-alive failed:', err);
      }
    }, 5000);

    // Handle '/joinRoom' form submissions
    const joinRoomForms = document.querySelectorAll('form[action="/joinRoom"]');
    joinRoomForms.forEach(form => {
      form.addEventListener('submit', async function(e) {
        e.preventDefault(); // Prevent default page reload
        
        const gameMode = form.querySelector('button[name="gameMode"]').value;
        
        try {
          const response = await fetch('/joinRoom', { // Target /joinRoom
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `gameMode=${encodeURIComponent(gameMode)}`
          });
          
          const data = await response.json();
          
          if (data.success && data.room) { // Check for data.room as well
            hideJoinButtons();
            // You'll need a showRoom function, similar to showTournamentRoom
            // For now, let's assume you adapt showTournamentRoom or create a new one
            showRoomDetails(data.room); // Example: adapt or create this function
          } else {
            alert('Error joining room: ' + (data.error || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error joining room:', error);
          alert('Failed to join room.');
        }
      });
    });
    
    // Handle '/leaveRoom' form submission (or button click if not a form)
    // Assuming the "leave game" button is inside a form action="/leaveRoom"
    const leaveRoomForm = document.querySelector('form[action="/leaveRoom"]');
    if (leaveRoomForm) {
      leaveRoomForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
          const response = await fetch('/leaveRoom', { // Target /leaveRoom
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded', // If your server expects this
            }
            // No body needed if just leaving based on cookie
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Adapt hideTournamentRoom and showJoinButtons or create new ones
            hideRoomDetails(); // Example: adapt or create this function
            showJoinButtons();
          } else {
            alert('Error leaving room: ' + (data.error || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error leaving room:', error);
          alert('Failed to leave room.');
        }
      });
    }

    // You'll need to adapt these functions or create new ones for match.html
    // For example, the room details section might be different.
    // The current showTournamentRoom is specific to tournament details.
    function showRoomDetails(room) {
      // Example: adapt this to match.html's room display elements
      document.getElementById('gameMode').textContent = room.gameMode;
      document.getElementById('playerCount').textContent = room.playerCount;
      document.getElementById('maxPlayers').textContent = room.maxPlayers;
      // document.getElementById('hostId').textContent = room.host; // Regular rooms might not have a host displayed
      document.getElementById('roomStatusContainer').style.display = 'block'; // Assuming you reuse this container
      // Adjust the title if needed
      document.querySelector('#roomStatusContainer h3').textContent = "Game Room";
    }

    function hideRoomDetails() {
      // Example: adapt this
      document.getElementById('roomStatusContainer').style.display = 'none';
    }

    function hideJoinButtons() {
      const container = document.querySelector('.container');
      if (container) container.style.display = 'none';
    }

    function showJoinButtons() {
      const container = document.querySelector('.container');
      if (container) container.style.display = 'block';
    }

  });
</script>


</body>
  
</html>